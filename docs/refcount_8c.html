<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Helios-Language: memory/refcount.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Helios-Language
   </div>
   <div id="projectbrief">A python inspired programming language with some extra features.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.15 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_267116d250309cbe7bd39c0026ee016a.html">memory</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">refcount.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;<a class="el" href="helios__memory_8h_source.html">helios_memory.h</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="helios__object_8h_source.html">helios_object.h</a>&gt;</code><br />
<code>#include &lt;stdbool.h&gt;</code><br />
<code>#include &lt;stdint.h&gt;</code><br />
<code>#include &lt;stdio.h&gt;</code><br />
<code>#include &lt;stdlib.h&gt;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for refcount.c:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="refcount_8c__incl.svg" width="490" height="336"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<p><a href="refcount_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a27b2da5d6954fd6e7aa0d2f352336c25"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structgarbagecollector.html">garbagecollector</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="refcount_8c.html#a27b2da5d6954fd6e7aa0d2f352336c25">helios_get_garbagecollector</a> ()</td></tr>
<tr class="separator:a27b2da5d6954fd6e7aa0d2f352336c25"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0352d829134eb27df2d9e088062e987d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="refcount_8c.html#a0352d829134eb27df2d9e088062e987d">helios_set_garbagecollector</a> (<a class="el" href="structgarbagecollector.html">garbagecollector</a> *gc)</td></tr>
<tr class="separator:a0352d829134eb27df2d9e088062e987d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaabde550780f37dc19f59b3e8bc9c514"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structgarbagecollector.html">garbagecollector</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="refcount_8c.html#aaabde550780f37dc19f59b3e8bc9c514">helios_init_garbagecollector</a> ()</td></tr>
<tr class="separator:aaabde550780f37dc19f59b3e8bc9c514"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0ba47c8ed7e1be60f1c360e33a0aff15"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="refcount_8c.html#a0ba47c8ed7e1be60f1c360e33a0aff15">helios_delete_garbagecollector</a> (<a class="el" href="structgarbagecollector.html">garbagecollector</a> *gc)</td></tr>
<tr class="separator:a0ba47c8ed7e1be60f1c360e33a0aff15"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a47893a5bfe810a5b4f9ebc3caace1728"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="refcount_8c.html#a47893a5bfe810a5b4f9ebc3caace1728">helios_set_garbagecollectable</a> (<a class="el" href="structhelios__object.html">helios_object</a> *obj)</td></tr>
<tr class="separator:a47893a5bfe810a5b4f9ebc3caace1728"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5dcd65b50eabfe133b9fcf6206b2bd1e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="refcount_8c.html#a5dcd65b50eabfe133b9fcf6206b2bd1e">helios_free_all_tracked</a> (<a class="el" href="structgarbagecollector.html">garbagecollector</a> *gc)</td></tr>
<tr class="separator:a5dcd65b50eabfe133b9fcf6206b2bd1e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a48e4eb31a7e7d92b0e015ae68c01bb3a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="refcount_8c.html#a48e4eb31a7e7d92b0e015ae68c01bb3a">helios_garbage_collect</a> (<a class="el" href="structgarbagecollector.html">garbagecollector</a> *gc)</td></tr>
<tr class="separator:a48e4eb31a7e7d92b0e015ae68c01bb3a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aab8866fd2abd9389795ad1639991caa4"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structhelios__object.html">helios_object</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="refcount_8c.html#aab8866fd2abd9389795ad1639991caa4">helios_allocate_object</a> (size_t size)</td></tr>
<tr class="separator:aab8866fd2abd9389795ad1639991caa4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8624e91857b860a62db7fc2cc20841b4"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="refcount_8c.html#a8624e91857b860a62db7fc2cc20841b4">helios_free_object</a> (<a class="el" href="structhelios__object.html">helios_object</a> *obj)</td></tr>
<tr class="separator:a8624e91857b860a62db7fc2cc20841b4"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:ae984dcde75fe497c211fa3e23888dadd"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structgarbagecollector.html">garbagecollector</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="refcount_8c.html#ae984dcde75fe497c211fa3e23888dadd">__GC_CURRENT</a> = NULL</td></tr>
<tr class="separator:ae984dcde75fe497c211fa3e23888dadd"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function Documentation</h2>
<a id="aab8866fd2abd9389795ad1639991caa4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aab8866fd2abd9389795ad1639991caa4">&#9670;&nbsp;</a></span>helios_allocate_object()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structhelios__object.html">helios_object</a>* helios_allocate_object </td>
          <td>(</td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>size</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Allocates a new helios object (and performs all the GC steps associated with that action). </p>
<p>Use this instead of malloc whenever a helios object is created.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">size</td><td>the size in bytes of an object to allocate </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>the newly allocated object </dd></dl>

<p class="definition">Definition at line <a class="el" href="refcount_8c_source.html#l00267">267</a> of file <a class="el" href="refcount_8c_source.html">refcount.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;                                                   {</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;<span class="preprocessor">#if HELIOS_MEMORY_DEBUG</span></div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;    printf(<span class="stringliteral">&quot;\x1b[31mhelios memory debug: allocated %ld bytes (%i objects &quot;</span></div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;           <span class="stringliteral">&quot;allocated)\x1b[0m\n&quot;</span>,</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;           size, ++__MEMDEBUG_objectsallocated);</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;    <a class="code" href="structhelios__object.html">helios_object</a> *res = (<a class="code" href="structhelios__object.html">helios_object</a> *)malloc(size);</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;<span class="preprocessor">#if HELIOS_MEMORY_DEBUG</span></div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;    printf(<span class="stringliteral">&quot;\x1b[31mallocated at 0x%lx\x1b[0m\n&quot;</span>, (uint64_t)res);</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;    <span class="keywordflow">return</span> res;</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;}</div><div class="ttc" id="structhelios__object_html"><div class="ttname"><a href="structhelios__object.html">helios_object</a></div><div class="ttdoc">Definition of the most basic helios object.</div><div class="ttdef"><b>Definition:</b> <a href="helios__object_8h_source.html#l00011">helios_object.h:11</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a0ba47c8ed7e1be60f1c360e33a0aff15"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0ba47c8ed7e1be60f1c360e33a0aff15">&#9670;&nbsp;</a></span>helios_delete_garbagecollector()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void helios_delete_garbagecollector </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structgarbagecollector.html">garbagecollector</a> *&#160;</td>
          <td class="paramname"><em>gc</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Free a garbagecollector object. </p>
<p>Also frees all it's tracked objects.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">gc</td><td>the garbagecollector to destroy. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="refcount_8c_source.html#l00095">95</a> of file <a class="el" href="refcount_8c_source.html">refcount.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;                                                          {</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;    <a class="code" href="refcount_8c.html#a5dcd65b50eabfe133b9fcf6206b2bd1e">helios_free_all_tracked</a>(gc);</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;    free(gc-&gt;<a class="code" href="structgarbagecollector.html#ab635d21bdac578501b1feacc8124f013">allocated_objects</a>);</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;    free(gc);</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;}</div><div class="ttc" id="structgarbagecollector_html_ab635d21bdac578501b1feacc8124f013"><div class="ttname"><a href="structgarbagecollector.html#ab635d21bdac578501b1feacc8124f013">garbagecollector::allocated_objects</a></div><div class="ttdeci">__helios_gc_hashmap_node * allocated_objects</div><div class="ttdef"><b>Definition:</b> <a href="helios__memory_8h_source.html#l00026">helios_memory.h:26</a></div></div>
<div class="ttc" id="refcount_8c_html_a5dcd65b50eabfe133b9fcf6206b2bd1e"><div class="ttname"><a href="refcount_8c.html#a5dcd65b50eabfe133b9fcf6206b2bd1e">helios_free_all_tracked</a></div><div class="ttdeci">void helios_free_all_tracked(garbagecollector *gc)</div><div class="ttdoc">Frees all tracked objects of a garbagecollector without freeing the GC itself.</div><div class="ttdef"><b>Definition:</b> <a href="refcount_8c_source.html#l00232">refcount.c:232</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="refcount_8c_a0ba47c8ed7e1be60f1c360e33a0aff15_cgraph.svg" width="414" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a5dcd65b50eabfe133b9fcf6206b2bd1e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5dcd65b50eabfe133b9fcf6206b2bd1e">&#9670;&nbsp;</a></span>helios_free_all_tracked()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void helios_free_all_tracked </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structgarbagecollector.html">garbagecollector</a> *&#160;</td>
          <td class="paramname"><em>gc</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Frees all tracked objects of a garbagecollector without freeing the GC itself. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">gc</td><td>the garbagecollector to free all tracked objects from </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="refcount_8c_source.html#l00232">232</a> of file <a class="el" href="refcount_8c_source.html">refcount.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;                                                   {</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;<span class="preprocessor">#if HELIOS_MEMORY_DEBUG</span></div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;    printf(<span class="stringliteral">&quot;\x1b[31mfreeing all tracked objects.\n\x1b[0m\n&quot;</span>);</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;    <span class="keywordflow">for</span> (uint32_t i = 0; i &lt; gc-&gt;<a class="code" href="structgarbagecollector.html#ae45ae787ff7ccbca16600ff1adc3d762">size</a>; i++) {</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;        <span class="keywordflow">if</span> (gc-&gt;<a class="code" href="structgarbagecollector.html#ab635d21bdac578501b1feacc8124f013">allocated_objects</a>[i].<a class="code" href="struct____helios__gc__hashmap__node.html#a32311561a1e3cfa95511b2a8fb517a95">used</a> == <span class="keyword">true</span>) {</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;            <a class="code" href="builtinutils_8h.html#aa862687a707dcd3bf49ff4ffc91871e4">HELIOS_CALL_MEMBER</a>(destructor, gc-&gt;<a class="code" href="structgarbagecollector.html#ab635d21bdac578501b1feacc8124f013">allocated_objects</a>[i].<a class="code" href="struct____helios__gc__hashmap__node.html#adbebba8ca971110112edfb370fcd4973">obj</a>);</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;        }</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;    }</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;}</div><div class="ttc" id="structgarbagecollector_html_ab635d21bdac578501b1feacc8124f013"><div class="ttname"><a href="structgarbagecollector.html#ab635d21bdac578501b1feacc8124f013">garbagecollector::allocated_objects</a></div><div class="ttdeci">__helios_gc_hashmap_node * allocated_objects</div><div class="ttdef"><b>Definition:</b> <a href="helios__memory_8h_source.html#l00026">helios_memory.h:26</a></div></div>
<div class="ttc" id="struct____helios__gc__hashmap__node_html_a32311561a1e3cfa95511b2a8fb517a95"><div class="ttname"><a href="struct____helios__gc__hashmap__node.html#a32311561a1e3cfa95511b2a8fb517a95">__helios_gc_hashmap_node::used</a></div><div class="ttdeci">bool used</div><div class="ttdef"><b>Definition:</b> <a href="helios__memory_8h_source.html#l00019">helios_memory.h:19</a></div></div>
<div class="ttc" id="builtinutils_8h_html_aa862687a707dcd3bf49ff4ffc91871e4"><div class="ttname"><a href="builtinutils_8h.html#aa862687a707dcd3bf49ff4ffc91871e4">HELIOS_CALL_MEMBER</a></div><div class="ttdeci">#define HELIOS_CALL_MEMBER(func, obj,...)</div><div class="ttdoc">This header is only there to resolve some circular dependency (with memory.h) issues but it fully bel...</div><div class="ttdef"><b>Definition:</b> <a href="builtinutils_8h_source.html#l00011">builtinutils.h:11</a></div></div>
<div class="ttc" id="structgarbagecollector_html_ae45ae787ff7ccbca16600ff1adc3d762"><div class="ttname"><a href="structgarbagecollector.html#ae45ae787ff7ccbca16600ff1adc3d762">garbagecollector::size</a></div><div class="ttdeci">uint32_t size</div><div class="ttdef"><b>Definition:</b> <a href="helios__memory_8h_source.html#l00024">helios_memory.h:24</a></div></div>
<div class="ttc" id="struct____helios__gc__hashmap__node_html_adbebba8ca971110112edfb370fcd4973"><div class="ttname"><a href="struct____helios__gc__hashmap__node.html#adbebba8ca971110112edfb370fcd4973">__helios_gc_hashmap_node::obj</a></div><div class="ttdeci">struct __helios_object_s * obj</div><div class="ttdef"><b>Definition:</b> <a href="helios__memory_8h_source.html#l00020">helios_memory.h:20</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a8624e91857b860a62db7fc2cc20841b4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8624e91857b860a62db7fc2cc20841b4">&#9670;&nbsp;</a></span>helios_free_object()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void helios_free_object </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structhelios__object.html">helios_object</a> *&#160;</td>
          <td class="paramname"><em>obj</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Frees a helios object. </p>
<p>removes it from the it's GC's tracked_objects array.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">obj</td><td>to object to free. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="refcount_8c_source.html#l00287">287</a> of file <a class="el" href="refcount_8c_source.html">refcount.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;                                            {</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;    <a class="code" href="structgarbagecollector.html">garbagecollector</a> *gc = <a class="code" href="helios__memory_8h.html#a5301b4c3358268578cde0b330c52efb2">HELIOS_GET_OBJ_GC</a>(obj);</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;<span class="preprocessor">#if HELIOS_MEMORY_DEBUG</span></div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;    printf(<span class="stringliteral">&quot;\x1b[31mhelios memory debug: freed %s object (%i objects &quot;</span></div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;           <span class="stringliteral">&quot;allocated)\x1b[0m\n&quot;</span>,</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;           obj-&gt;class-&gt;classname, --__MEMDEBUG_objectsallocated);</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;    printf(<span class="stringliteral">&quot;\x1b[31mfreed from 0x%lx\x1b[0m\n&quot;</span>, (uint64_t)obj);</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;    uint64_t index = __hashfunction((uint64_t)obj) % gc-&gt;<a class="code" href="structgarbagecollector.html#ae45ae787ff7ccbca16600ff1adc3d762">size</a>;</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;    <span class="keywordflow">while</span> (1) {</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;        <span class="keywordflow">if</span> (gc-&gt;<a class="code" href="structgarbagecollector.html#ab635d21bdac578501b1feacc8124f013">allocated_objects</a>[index].<a class="code" href="struct____helios__gc__hashmap__node.html#a32311561a1e3cfa95511b2a8fb517a95">used</a>) {</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;            <span class="keywordflow">if</span> (gc-&gt;<a class="code" href="structgarbagecollector.html#ab635d21bdac578501b1feacc8124f013">allocated_objects</a>[index].<a class="code" href="struct____helios__gc__hashmap__node.html#adbebba8ca971110112edfb370fcd4973">obj</a> == obj) {</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;                <span class="keywordflow">break</span>;</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;            }</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;        }</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;        index = (index + 1) % gc-&gt;<a class="code" href="structgarbagecollector.html#ae45ae787ff7ccbca16600ff1adc3d762">size</a>;</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;    }</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;<span class="preprocessor">#if HELIOS_MEMORY_DEBUG</span></div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;    printf(<span class="stringliteral">&quot;\x1b[34mat index %li\x1b[0m\n&quot;</span>, index);</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;    gc-&gt;<a class="code" href="structgarbagecollector.html#ab635d21bdac578501b1feacc8124f013">allocated_objects</a>[index].<a class="code" href="struct____helios__gc__hashmap__node.html#a32311561a1e3cfa95511b2a8fb517a95">used</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;    gc-&gt;<a class="code" href="structgarbagecollector.html#ab635d21bdac578501b1feacc8124f013">allocated_objects</a>[index].<a class="code" href="struct____helios__gc__hashmap__node.html#adbebba8ca971110112edfb370fcd4973">obj</a> = NULL;</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;    gc-&gt;<a class="code" href="structgarbagecollector.html#a0d6ec8a21c69c450e0631523fa685cf7">filled</a>--;</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;    free(obj);</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;<span class="preprocessor">#if HELIOS_MEMORY_DEBUG</span></div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;    printf(<span class="stringliteral">&quot;\x1b[33mgc size: %i/%i\x1b[0m\n&quot;</span>, obj-&gt;gc-&gt;filled, obj-&gt;gc-&gt;size);</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;}</div><div class="ttc" id="structgarbagecollector_html_ab635d21bdac578501b1feacc8124f013"><div class="ttname"><a href="structgarbagecollector.html#ab635d21bdac578501b1feacc8124f013">garbagecollector::allocated_objects</a></div><div class="ttdeci">__helios_gc_hashmap_node * allocated_objects</div><div class="ttdef"><b>Definition:</b> <a href="helios__memory_8h_source.html#l00026">helios_memory.h:26</a></div></div>
<div class="ttc" id="struct____helios__gc__hashmap__node_html_a32311561a1e3cfa95511b2a8fb517a95"><div class="ttname"><a href="struct____helios__gc__hashmap__node.html#a32311561a1e3cfa95511b2a8fb517a95">__helios_gc_hashmap_node::used</a></div><div class="ttdeci">bool used</div><div class="ttdef"><b>Definition:</b> <a href="helios__memory_8h_source.html#l00019">helios_memory.h:19</a></div></div>
<div class="ttc" id="structgarbagecollector_html_a0d6ec8a21c69c450e0631523fa685cf7"><div class="ttname"><a href="structgarbagecollector.html#a0d6ec8a21c69c450e0631523fa685cf7">garbagecollector::filled</a></div><div class="ttdeci">uint32_t filled</div><div class="ttdef"><b>Definition:</b> <a href="helios__memory_8h_source.html#l00025">helios_memory.h:25</a></div></div>
<div class="ttc" id="structgarbagecollector_html_ae45ae787ff7ccbca16600ff1adc3d762"><div class="ttname"><a href="structgarbagecollector.html#ae45ae787ff7ccbca16600ff1adc3d762">garbagecollector::size</a></div><div class="ttdeci">uint32_t size</div><div class="ttdef"><b>Definition:</b> <a href="helios__memory_8h_source.html#l00024">helios_memory.h:24</a></div></div>
<div class="ttc" id="struct____helios__gc__hashmap__node_html_adbebba8ca971110112edfb370fcd4973"><div class="ttname"><a href="struct____helios__gc__hashmap__node.html#adbebba8ca971110112edfb370fcd4973">__helios_gc_hashmap_node::obj</a></div><div class="ttdeci">struct __helios_object_s * obj</div><div class="ttdef"><b>Definition:</b> <a href="helios__memory_8h_source.html#l00020">helios_memory.h:20</a></div></div>
<div class="ttc" id="structgarbagecollector_html"><div class="ttname"><a href="structgarbagecollector.html">garbagecollector</a></div><div class="ttdef"><b>Definition:</b> <a href="helios__memory_8h_source.html#l00023">helios_memory.h:23</a></div></div>
<div class="ttc" id="helios__memory_8h_html_a5301b4c3358268578cde0b330c52efb2"><div class="ttname"><a href="helios__memory_8h.html#a5301b4c3358268578cde0b330c52efb2">HELIOS_GET_OBJ_GC</a></div><div class="ttdeci">#define HELIOS_GET_OBJ_GC(obj)</div><div class="ttdoc">Get the garbagecollector of an object.</div><div class="ttdef"><b>Definition:</b> <a href="helios__memory_8h_source.html#l00049">helios_memory.h:49</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a48e4eb31a7e7d92b0e015ae68c01bb3a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a48e4eb31a7e7d92b0e015ae68c01bb3a">&#9670;&nbsp;</a></span>helios_garbage_collect()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void helios_garbage_collect </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structgarbagecollector.html">garbagecollector</a> *&#160;</td>
          <td class="paramname"><em>gc</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Perform a GC cleanup cycle. </p>
<p>Iterates through a garbagecollector's tracked objects and frees any object with a reference count which is less than or equal to 0.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">gc</td><td>the gc to perform garbage collection on </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="refcount_8c_source.html#l00250">250</a> of file <a class="el" href="refcount_8c_source.html">refcount.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;                                                  {</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;    <span class="keywordflow">for</span> (uint32_t i = 0; i &lt; gc-&gt;<a class="code" href="structgarbagecollector.html#a0d6ec8a21c69c450e0631523fa685cf7">filled</a>; i++) {</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;        <span class="keywordflow">if</span> (gc-&gt;<a class="code" href="structgarbagecollector.html#ab635d21bdac578501b1feacc8124f013">allocated_objects</a>[i].<a class="code" href="struct____helios__gc__hashmap__node.html#a32311561a1e3cfa95511b2a8fb517a95">used</a> == <span class="keyword">true</span> &amp;&amp;</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;            <a class="code" href="helios__memory_8h.html#a8c172aa0256138d40339d80c3f9a1540">HELIOS_GETREF</a>(gc-&gt;<a class="code" href="structgarbagecollector.html#ab635d21bdac578501b1feacc8124f013">allocated_objects</a>[i].<a class="code" href="struct____helios__gc__hashmap__node.html#adbebba8ca971110112edfb370fcd4973">obj</a>) &lt;= 0) {</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;            <a class="code" href="builtinutils_8h.html#aa862687a707dcd3bf49ff4ffc91871e4">HELIOS_CALL_MEMBER</a>(destructor, gc-&gt;<a class="code" href="structgarbagecollector.html#ab635d21bdac578501b1feacc8124f013">allocated_objects</a>[i].<a class="code" href="struct____helios__gc__hashmap__node.html#adbebba8ca971110112edfb370fcd4973">obj</a>);</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;        }</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;    }</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;}</div><div class="ttc" id="structgarbagecollector_html_ab635d21bdac578501b1feacc8124f013"><div class="ttname"><a href="structgarbagecollector.html#ab635d21bdac578501b1feacc8124f013">garbagecollector::allocated_objects</a></div><div class="ttdeci">__helios_gc_hashmap_node * allocated_objects</div><div class="ttdef"><b>Definition:</b> <a href="helios__memory_8h_source.html#l00026">helios_memory.h:26</a></div></div>
<div class="ttc" id="struct____helios__gc__hashmap__node_html_a32311561a1e3cfa95511b2a8fb517a95"><div class="ttname"><a href="struct____helios__gc__hashmap__node.html#a32311561a1e3cfa95511b2a8fb517a95">__helios_gc_hashmap_node::used</a></div><div class="ttdeci">bool used</div><div class="ttdef"><b>Definition:</b> <a href="helios__memory_8h_source.html#l00019">helios_memory.h:19</a></div></div>
<div class="ttc" id="builtinutils_8h_html_aa862687a707dcd3bf49ff4ffc91871e4"><div class="ttname"><a href="builtinutils_8h.html#aa862687a707dcd3bf49ff4ffc91871e4">HELIOS_CALL_MEMBER</a></div><div class="ttdeci">#define HELIOS_CALL_MEMBER(func, obj,...)</div><div class="ttdoc">This header is only there to resolve some circular dependency (with memory.h) issues but it fully bel...</div><div class="ttdef"><b>Definition:</b> <a href="builtinutils_8h_source.html#l00011">builtinutils.h:11</a></div></div>
<div class="ttc" id="structgarbagecollector_html_a0d6ec8a21c69c450e0631523fa685cf7"><div class="ttname"><a href="structgarbagecollector.html#a0d6ec8a21c69c450e0631523fa685cf7">garbagecollector::filled</a></div><div class="ttdeci">uint32_t filled</div><div class="ttdef"><b>Definition:</b> <a href="helios__memory_8h_source.html#l00025">helios_memory.h:25</a></div></div>
<div class="ttc" id="struct____helios__gc__hashmap__node_html_adbebba8ca971110112edfb370fcd4973"><div class="ttname"><a href="struct____helios__gc__hashmap__node.html#adbebba8ca971110112edfb370fcd4973">__helios_gc_hashmap_node::obj</a></div><div class="ttdeci">struct __helios_object_s * obj</div><div class="ttdef"><b>Definition:</b> <a href="helios__memory_8h_source.html#l00020">helios_memory.h:20</a></div></div>
<div class="ttc" id="helios__memory_8h_html_a8c172aa0256138d40339d80c3f9a1540"><div class="ttname"><a href="helios__memory_8h.html#a8c172aa0256138d40339d80c3f9a1540">HELIOS_GETREF</a></div><div class="ttdeci">#define HELIOS_GETREF(obj)</div><div class="ttdoc">Get the reference count of an object.</div><div class="ttdef"><b>Definition:</b> <a href="helios__memory_8h_source.html#l00089">helios_memory.h:89</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a27b2da5d6954fd6e7aa0d2f352336c25"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a27b2da5d6954fd6e7aa0d2f352336c25">&#9670;&nbsp;</a></span>helios_get_garbagecollector()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structgarbagecollector.html">garbagecollector</a>* helios_get_garbagecollector </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get the global current garbage collector. </p>
<p>Errors whenever this value is not set.</p>
<dl class="section return"><dt>Returns</dt><dd>the current GC </dd></dl>

<p class="definition">Definition at line <a class="el" href="refcount_8c_source.html#l00051">51</a> of file <a class="el" href="refcount_8c_source.html">refcount.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;                                                {</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="refcount_8c.html#ae984dcde75fe497c211fa3e23888dadd">__GC_CURRENT</a> == NULL) {</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;        printf(</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;            <span class="stringliteral">&quot;ERROR: no garbage collector found (fix: use &quot;</span></div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;            <span class="stringliteral">&quot;helios_init_garbagecollector and helios_set_garbagecollector)\n&quot;</span>);</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;        exit(-1);</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;    }</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="refcount_8c.html#ae984dcde75fe497c211fa3e23888dadd">__GC_CURRENT</a>;</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;}</div><div class="ttc" id="refcount_8c_html_ae984dcde75fe497c211fa3e23888dadd"><div class="ttname"><a href="refcount_8c.html#ae984dcde75fe497c211fa3e23888dadd">__GC_CURRENT</a></div><div class="ttdeci">garbagecollector * __GC_CURRENT</div><div class="ttdoc">Garbage collector objects are a field in any thread, and any object has a pointer to one.</div><div class="ttdef"><b>Definition:</b> <a href="refcount_8c_source.html#l00039">refcount.c:39</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aaabde550780f37dc19f59b3e8bc9c514"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aaabde550780f37dc19f59b3e8bc9c514">&#9670;&nbsp;</a></span>helios_init_garbagecollector()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structgarbagecollector.html">garbagecollector</a>* helios_init_garbagecollector </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Creates a new garbagecollector object. </p>
<p>NOTE: doesnt automatically set it as the current GC. This has to be done manually.</p>
<p>TODO: create shortcut function for creating a GC and setting it as current.</p>
<dl class="section return"><dt>Returns</dt><dd>a newly created garbagecollector. </dd></dl>

<p class="definition">Definition at line <a class="el" href="refcount_8c_source.html#l00078">78</a> of file <a class="el" href="refcount_8c_source.html">refcount.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;                                                 {</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    <a class="code" href="structgarbagecollector.html">garbagecollector</a> *gc = malloc(<span class="keyword">sizeof</span>(<a class="code" href="structgarbagecollector.html">garbagecollector</a>));</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    *gc = (<a class="code" href="structgarbagecollector.html">garbagecollector</a>){</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;        <a class="code" href="helios__memory_8h.html#a5e29bea4269384b13c7e2799b02d4ded">GC_DEFAULT_LENGTH</a>, 0,</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;        malloc(<a class="code" href="helios__memory_8h.html#a5e29bea4269384b13c7e2799b02d4ded">GC_DEFAULT_LENGTH</a> * <span class="keyword">sizeof</span>(<a class="code" href="struct____helios__gc__hashmap__node.html">__helios_gc_hashmap_node</a>))};</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    <span class="keywordflow">for</span> (uint32_t i = 0; i &lt; gc-&gt;<a class="code" href="structgarbagecollector.html#ae45ae787ff7ccbca16600ff1adc3d762">size</a>; i++) {</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;        gc-&gt;<a class="code" href="structgarbagecollector.html#ab635d21bdac578501b1feacc8124f013">allocated_objects</a>[i].<a class="code" href="struct____helios__gc__hashmap__node.html#a32311561a1e3cfa95511b2a8fb517a95">used</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;        gc-&gt;<a class="code" href="structgarbagecollector.html#ab635d21bdac578501b1feacc8124f013">allocated_objects</a>[i].<a class="code" href="struct____helios__gc__hashmap__node.html#adbebba8ca971110112edfb370fcd4973">obj</a> = NULL;</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;    }</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    <span class="keywordflow">return</span> gc;</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;}</div><div class="ttc" id="structgarbagecollector_html_ab635d21bdac578501b1feacc8124f013"><div class="ttname"><a href="structgarbagecollector.html#ab635d21bdac578501b1feacc8124f013">garbagecollector::allocated_objects</a></div><div class="ttdeci">__helios_gc_hashmap_node * allocated_objects</div><div class="ttdef"><b>Definition:</b> <a href="helios__memory_8h_source.html#l00026">helios_memory.h:26</a></div></div>
<div class="ttc" id="struct____helios__gc__hashmap__node_html_a32311561a1e3cfa95511b2a8fb517a95"><div class="ttname"><a href="struct____helios__gc__hashmap__node.html#a32311561a1e3cfa95511b2a8fb517a95">__helios_gc_hashmap_node::used</a></div><div class="ttdeci">bool used</div><div class="ttdef"><b>Definition:</b> <a href="helios__memory_8h_source.html#l00019">helios_memory.h:19</a></div></div>
<div class="ttc" id="structgarbagecollector_html_ae45ae787ff7ccbca16600ff1adc3d762"><div class="ttname"><a href="structgarbagecollector.html#ae45ae787ff7ccbca16600ff1adc3d762">garbagecollector::size</a></div><div class="ttdeci">uint32_t size</div><div class="ttdef"><b>Definition:</b> <a href="helios__memory_8h_source.html#l00024">helios_memory.h:24</a></div></div>
<div class="ttc" id="struct____helios__gc__hashmap__node_html_adbebba8ca971110112edfb370fcd4973"><div class="ttname"><a href="struct____helios__gc__hashmap__node.html#adbebba8ca971110112edfb370fcd4973">__helios_gc_hashmap_node::obj</a></div><div class="ttdeci">struct __helios_object_s * obj</div><div class="ttdef"><b>Definition:</b> <a href="helios__memory_8h_source.html#l00020">helios_memory.h:20</a></div></div>
<div class="ttc" id="helios__memory_8h_html_a5e29bea4269384b13c7e2799b02d4ded"><div class="ttname"><a href="helios__memory_8h.html#a5e29bea4269384b13c7e2799b02d4ded">GC_DEFAULT_LENGTH</a></div><div class="ttdeci">#define GC_DEFAULT_LENGTH</div><div class="ttdef"><b>Definition:</b> <a href="helios__memory_8h_source.html#l00012">helios_memory.h:12</a></div></div>
<div class="ttc" id="struct____helios__gc__hashmap__node_html"><div class="ttname"><a href="struct____helios__gc__hashmap__node.html">__helios_gc_hashmap_node</a></div><div class="ttdef"><b>Definition:</b> <a href="helios__memory_8h_source.html#l00018">helios_memory.h:18</a></div></div>
<div class="ttc" id="structgarbagecollector_html"><div class="ttname"><a href="structgarbagecollector.html">garbagecollector</a></div><div class="ttdef"><b>Definition:</b> <a href="helios__memory_8h_source.html#l00023">helios_memory.h:23</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a47893a5bfe810a5b4f9ebc3caace1728"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a47893a5bfe810a5b4f9ebc3caace1728">&#9670;&nbsp;</a></span>helios_set_garbagecollectable()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void helios_set_garbagecollectable </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structhelios__object.html">helios_object</a> *&#160;</td>
          <td class="paramname"><em>obj</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Registers an object in the garbagecollector to be freed later. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">obj</td><td>the object to start tracking </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="refcount_8c_source.html#l00213">213</a> of file <a class="el" href="refcount_8c_source.html">refcount.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;                                                       {</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    obj-&gt;gc = <a class="code" href="refcount_8c.html#a27b2da5d6954fd6e7aa0d2f352336c25">helios_get_garbagecollector</a>();</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;    <a class="code" href="helios__memory_8h.html#ad6a677794da9e4d1890752b20985794b">HELIOS_INCREF</a>(obj);</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;    helios_track_object(obj);</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;<span class="preprocessor">#if HELIOS_MEMORY_DEBUG</span></div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;    printf(<span class="stringliteral">&quot;\x1b[31mhelios memory debug: assigned gc at 0x%lx to object of &quot;</span></div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;           <span class="stringliteral">&quot;type %s\x1b[0m\n&quot;</span>,</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;           (uint64_t)obj-&gt;gc, obj-&gt;class-&gt;classname);</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;    printf(<span class="stringliteral">&quot;\x1b[33mgc size: %i/%i\x1b[0m\n&quot;</span>, obj-&gt;gc-&gt;filled, obj-&gt;gc-&gt;size);</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;}</div><div class="ttc" id="helios__memory_8h_html_ad6a677794da9e4d1890752b20985794b"><div class="ttname"><a href="helios__memory_8h.html#ad6a677794da9e4d1890752b20985794b">HELIOS_INCREF</a></div><div class="ttdeci">#define HELIOS_INCREF(obj)</div><div class="ttdoc">Increment the reference count of an object.</div><div class="ttdef"><b>Definition:</b> <a href="helios__memory_8h_source.html#l00054">helios_memory.h:54</a></div></div>
<div class="ttc" id="refcount_8c_html_a27b2da5d6954fd6e7aa0d2f352336c25"><div class="ttname"><a href="refcount_8c.html#a27b2da5d6954fd6e7aa0d2f352336c25">helios_get_garbagecollector</a></div><div class="ttdeci">garbagecollector * helios_get_garbagecollector()</div><div class="ttdoc">Get the global current garbage collector.</div><div class="ttdef"><b>Definition:</b> <a href="refcount_8c_source.html#l00051">refcount.c:51</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="refcount_8c_a47893a5bfe810a5b4f9ebc3caace1728_cgraph.svg" width="438" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a0352d829134eb27df2d9e088062e987d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0352d829134eb27df2d9e088062e987d">&#9670;&nbsp;</a></span>helios_set_garbagecollector()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void helios_set_garbagecollector </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structgarbagecollector.html">garbagecollector</a> *&#160;</td>
          <td class="paramname"><em>gc</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Points the global garbagecollector pointer to a new garbagecollector. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">gc</td><td>the new gc </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="refcount_8c_source.html#l00066">66</a> of file <a class="el" href="refcount_8c_source.html">refcount.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;                                                       {</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    <a class="code" href="refcount_8c.html#ae984dcde75fe497c211fa3e23888dadd">__GC_CURRENT</a> = gc;</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;}</div><div class="ttc" id="refcount_8c_html_ae984dcde75fe497c211fa3e23888dadd"><div class="ttname"><a href="refcount_8c.html#ae984dcde75fe497c211fa3e23888dadd">__GC_CURRENT</a></div><div class="ttdeci">garbagecollector * __GC_CURRENT</div><div class="ttdoc">Garbage collector objects are a field in any thread, and any object has a pointer to one.</div><div class="ttdef"><b>Definition:</b> <a href="refcount_8c_source.html#l00039">refcount.c:39</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="ae984dcde75fe497c211fa3e23888dadd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae984dcde75fe497c211fa3e23888dadd">&#9670;&nbsp;</a></span>__GC_CURRENT</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structgarbagecollector.html">garbagecollector</a>* __GC_CURRENT = NULL</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Garbage collector objects are a field in any thread, and any object has a pointer to one. </p>
<p>A garbagecollector can be in one and only one thread. An object can have only one garbagecollector and therefore an object can be in only one thread. An object's refcount is only important for it's own garbage collector.</p>
<p>To be implemented: When an object is transfered between threads (which is fully possible) it is (i am not entirely sure how this is going to work) either completely copied or all references to it in the original thread are broken (any subsequent access will result in an error). Any new object, unless created with the special helios_allocate_object_on_gc function which allocates an object on a specific garbage collector, will be allocated with the garbagecollector of the current running thread. (currently a global variable but this will be refactored to be inside thread objects).</p>
<p>Warining: When running Helios code in c one has to always first create a garbagecollector. When freeing a garbagecollector, all it's tracked objects are untracked and freed too. It is however possible to free all objects in a garbage collector without freeing it (for reuse) with helios_free_all_tracked.</p>
<p>TODO: maybe use the garbagecollector prefix more consistently and not at the end of names like in helios_init_garbagecollector</p>
<p>TODO: object reuse. instead of freeing it, keep it with a refcount of 0 in the GC and allow it to be repurposed without calling malloc again.</p>
<p>TODO: cycle detection </p>

<p class="definition">Definition at line <a class="el" href="refcount_8c_source.html#l00039">39</a> of file <a class="el" href="refcount_8c_source.html">refcount.c</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Tue Mar 26 2019 12:03:54 for Helios-Language by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.15
</small></address>
</body>
</html>
